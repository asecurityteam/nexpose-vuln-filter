package nexpose

// AssetVulnerabilityWithDetails is an AssetVulnerability with the vulnerability
// corresponding to the ID included in the payload
type AssetVulnerabilityWithDetails struct {
	AssetVulnerability
	Vulnerability Vulnerability `json:"vulnerability"`
}

// AssetVulnerability represents the details for a vulnerability found on an asset
// See: https://help.rapid7.com/insightvm/en-us/api/index.html#operation/getAssetVulnerability
type AssetVulnerability struct {
	ID        string   `json:"id"`
	Instances int32    `json:"instances"`
	Links     []Link   `json:"links"`
	Results   []Result `json:"results"`
	Status    string   `json:"status"`
}

// Result represents a vulnerability check result
type Result struct {
	CheckID    string  `json:"checkId"`
	Exceptions []int32 `json:"exception"`
	Key        string  `json:"key"`
	Links      []Link  `json:"links"`
	Port       int32   `json:"port"`
	Proof      string  `json:"proof"`
	Protocol   string  `json:"protocol"`
	Status     string  `json:"status"`
}

// Vulnerability represents a Nexpose vulnerability response payload
// See: https://help.rapid7.com/insightvm/en-us/api/index.html#operation/getVulnerability
type Vulnerability struct {
	DateAdded       string      `json:"added"`
	Categories      []string    `json:"categories"`
	CVEs            []string    `json:"cves"`
	CVSS            CVSS        `json:"cvss"`
	DenialOfService bool        `json:"denialOfService"`
	Description     Description `json:"description"`
	Exploits        int32       `json:"exploits"`
	ID              string      `json:"id"`
	Links           []Link      `json:"links"`
	MalwareKits     int32       `json:"malwareKits"`
	DateModified    string      `json:"modified"`
	PCI             PCI         `json:"pci"`
	DatePublished   string      `json:"published"`
	RiskScore       float32     `json:"riskScore"`
	Severity        string      `json:"severity"`
	SeverityScore   int32       `json:"severityScore"`
	Title           string      `json:"title"`
}

// CVSS represents the CVSS field of a Nexpose vulnerability
type CVSS struct {
	Links       []Link      `json:"links"`
	CVSSV2Score CVSSV2Score `json:"v2"`
	CVSSV3Score CVSSV3Score `json:"v3"`
}

// CVSSV2Score represents the v2 payload in a CVSS object seen above
type CVSSV2Score struct {
	AccessComplexity      string  `json:"accessComplexity"`
	AccessVector          string  `json:"accessVector"`
	Authentication        string  `json:"authentication"`
	AvailabilityImpact    string  `json:"availabilityImpact"`
	ConfidentialityImpact string  `json:"confidentialityImpact"`
	ExploitScore          float64 `json:"exploitScore"`
	ImpactScore           float64 `json:"impactScore"`
	IntegrityImpact       string  `json:"integrityImpact"`
	Score                 float64 `json:"score"`
	Vector                string  `json:"vector"`
}

// CVSSV3Score represents the v3 payload in a CVSS object seen above
type CVSSV3Score struct {
	AttackComplexity      string  `json:"attackComplexity"`
	AttackVector          string  `json:"attackVector"`
	AvailabilityImpact    string  `json:"availabilityImpact"`
	ConfidentialityImpact string  `json:"confidentialityImpact"`
	ExploitScore          float64 `json:"exploitScore"`
	ImpactScore           float64 `json:"impactScore"`
	IntegrityImpact       string  `json:"integrityImpact"`
	PrivilegeRequired     string  `json:"privilegeRequired"`
	Scope                 string  `json:"scope"`
	Score                 float64 `json:"score"`
	Vector                string  `json:"vector"`
}

// Description represents the description field of a vulnerability
type Description struct {
	HTML string `json:"html"`
	Text string `json:"text"`
}

// PCI represents the pci field of a vulnerability
type PCI struct {
	AdjustedCVSSScore     int32  `json:"adjustedCVSSScore"`
	AdjustedSeverityScore int32  `json:"adjustedSeverityScore"`
	Fail                  bool   `json:"fail"`
	SpecialNotes          string `json:"specialNotes"`
	Status                string `json:"status"`
}
